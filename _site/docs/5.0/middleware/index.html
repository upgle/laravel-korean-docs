<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>HTTP 미들웨어(HTTP Middleware)</title>
  <meta name="description" content="라라벨 한글 메뉴얼에 대한 메뉴얼 페이지입니다.">

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="/laravel-korean-docs/js/prism.js"></script>

  <link rel="stylesheet" href="/laravel-korean-docs/css/layout.css">
  <link rel="canonical" href="http://www.xpressengine.com/laravel-korean-docs/docs/5.0/middleware/">
</head>


  <body>

    <div class="container">
    <header>
        <div class="wrap">
            <h1 class="logo">Laravel korean docs <small>laravel 한글 매뉴얼</small></h1>
            <div class="btn_area">
                <a class="button" href="https://github.com/xpressengine/laravel-korean-docs/tree/kr-5.0/kr">View on Github</a>
                <a class="button" href="https://github.com/xpressengine/laravel-korean-docs/archive/kr-5.0.zip">Download.zip</a>
                <a class="button" href="https://github.com/xpressengine/laravel-korean-docs.git">Git Repository</a>
            </div>
        </div>
    </header>
    <div class="supported">
        <div class="wrap">
            <a class="bnr" href="http://www.xpressengine.com"><img src="/laravel-korean-docs/img/bnr1.png" /></a><a class="bnr" href="http://dev.naver.com/d2"><img src="/laravel-korean-docs/img/bnr2.png" /></a><a class="bnr" href="http://xpressengine.github.io/XEIcon/"><img src="/laravel-korean-docs/img/bnr3.png" /></a><a class="bnr" href="http://xpressengine.github.io/Composer-korean-docs/"><img src="/laravel-korean-docs/img/bnr4.png" /></a><a class="bnr" href="http://laravel.com/"><img src="/laravel-korean-docs/img/bnr5.png" /></a>
        </div>
    </div>
    <div class="body docs">
        <div class="wrap">
            <section class="sidebar">
            <ul>
    <li>Prologue
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/upgrade">업그레이드 가이드</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/contributions">기여 가이드</a></li>
        </ul>
    </li>
    <li>Setup
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/installation">설치하기</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/configuration">설정</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/homestead">라라벨 홈스테드</a></li>
        </ul>
    </li>
    <li>The Basics
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/routing">HTTP 라우팅</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/middleware">HTTP 미들웨어</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/controllers">HTTP 컨트롤러</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/requests">Requests</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/responses">Responses</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/views">뷰-Views</a></li>
        </ul>
    </li>
    <li>Architecture Foundations
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/providers">서비스 프로바이더</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/container">서비스 컨테이너</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/contracts">Contracts</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/facades">파사드</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/lifecycle">라이프사이클</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/structure">어플리케이션 구조</a></li>
        </ul>
    </li>
    <li>Services
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/authentication">인증</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/billing">라라벨 캐셔</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/cache">캐시</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/collections">컬렉션</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/bus">커맨드 버스</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/extending">프레임워크의 확장</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/elixir">라라벨 엘릭서</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/encryption">암호화</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/envoy">Envoy</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/errors">에러와 로깅</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/events">이벤트</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/filesystem">파일시스템 / 클라우드 스토리지</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/hashing">해시</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/helpers">헬퍼 함수</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/localization">지역화-다국어</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/mail">메일</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/packages">패키지 개발</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/pagination">페이지네이션</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/queues">큐</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/session">세션</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/templates">템플릿</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/testing">테스팅</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/validation">Validation</a></li>
        </ul>
    </li>
    <li>Database
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/database">기본적인 데이터 베이스 사용법</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/queries">쿼리 빌더</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/eloquent">Eloquent ORM</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/schema">스키마 빌더</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/migrations">마이그레이션과 시딩</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/redis">Redis</a></li>
        </ul>
    </li>
    <li>Artisan CLI
        <ul>
            <li><a href="/laravel-korean-docs/docs/5.0/artisan">아티즌 CLI</a></li>
            <li><a href="/laravel-korean-docs/docs/5.0/commands">아티즌 명령어 개발하기</a></li>
        </ul>
    </li>
</ul>
            </section>

      <article class="content">
      <h1 id="http-미들웨어(http-middleware)">HTTP 미들웨어(HTTP Middleware)</h1>

<ul>
<li><a href="#introduction">소개</a> </li>
<li><a href="#defining-middleware">미들웨어 정의하기</a></li>
<li><a href="#registering-middleware">미들웨어 등록하기</a></li>
<li><a href="#terminable-middleware">종료가능한 미들웨어</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2 id="소개">소개</h2>

<p>HTTP 미들웨어는 어플리케이션으로 들어온 HTTP 요청을 간편하게 필터링할 수 있는 방법을 제공합니다. 예를 들어, 라라벨은 어플리케이션의 사용자가 인증되었는지 검사하는 미들웨어를 내장하고 있습니다. 만약 인증되지 않은 사용자라면, 미들웨어는 그 사용자를 로그인 화면으로 리다이렉트 시킬 것입니다. 반대로, 인증된 사용자라면, 미들웨어는 어플리케이션에서 HTTP 요청이 계속해서 처리되도록 허용할 것입니다.</p>

<p>물론, 미들웨어는 인증 이외에도 다양한 작업을 수행하도록 작성될 수 있습니다. CORS 미들웨어는 어플리케이션에서 내보내는 모든 응답에 적절한 헤더들을 추가하는 역할을 담당할 수도 있습니다. 로깅 미들웨어는 어플리케이션으로 들어오는 모든 요청을 기록할 수도 있습니다.</p>

<p>라라벨 프레임워크에는 유지보수모드-공사중(maintenance), 인증(authentication), CSRF 보안 등을 위한 미들웨어들이 포함되어 있습니다. 그 미들웨어들은 모두 <code>app/Http/Middleware</code> 디렉토리 안에 위치하고 있습니다.</p>

<p><a name="defining-middleware"></a></p>

<h2 id="미들웨어-정의하기">미들웨어 정의하기</h2>

<p>새로운 미들웨어를 생성하기 위하여 <code>make:middleware</code> Artisan 명령을 사용할 수 있습니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">php artisan make:middleware OldMiddleware
</code></pre></div>
<p>이 명령은 <code>OldMiddleware</code> 클래스를 생성하여 <code>app/Http/Middleware</code> 디렉토리에 위치시킬 것입니다. 이 미들웨어 에서 우리는 입력받은 <code>age</code>가 200보다 클 때에만 요청된 주소에 접근할 수 있도록 허용하려고 합니다. 그렇지 않으면 우리는 사용자를 &quot;home&quot;으로 리다이렉트할 것입니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;?php namespace App\Http\Middleware;

class OldMiddleware {

    /**
     * Run the request filter.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Closure  $next
     * @return mixed
     */
    public function handle($request, Closure $next)
    {
        if ($request-&gt;input(&#39;age&#39;) &lt; 200)
        {
            return redirect(&#39;home&#39;);
        }

        return $next($request);
    }

}
</code></pre></div>
<p>위 코드에서 볼 수 있듯이, 주어진 <code>age</code>가 200보다 작으면 미들웨어는 HTTP 리다이렉트를 클라이언트에게 반환할 것입니다; 그렇지 않으면 요청은 어플리케이션 안으로 더 깊이 전달될 것입니다. (미들웨어가 &quot;pass&quot;를  허용하는) 요청을 어플리케이션 안으로 더 깊이 전달하기 원한다면, 간단하게 <code>$next</code> 콜백함수를 <code>$request</code>인자를 넣어 호출하면 됩니다.</p>

<p>미들웨어를 HTTP request들이 어플리케이션에 도달하기 전에 반드시 통과해야 하는 일련의 &quot;레이어&quot;라고 상상하는 것이 가장 좋습니다. 각각의 레이어는 요청을 검사할 수 있고 완벽하게 요청을 거절할 수도 있습니다.</p>

<h3 id="before-/-after-미들웨어"><em>Before</em> / <em>After</em> 미들웨어</h3>

<p>요청을 어플리케이션이 처리하기 전에 미들웨어가 실행될지 처리한 후에 미들웨어가 실행될지는 미들웨어 자신이 결정할 수 있습니다. 아래의 경우, 미들웨어는 요청이 어플리케이션에 의해 처리되기 <strong>전</strong>에 실행될 것입니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;?php namespace App\Http\Middleware;

class BeforeMiddleware implements Middleware {

    public function handle($request, Closure $next)
    {
        // Perform action

        return $next($request);
    }
}
</code></pre></div>
<p>반대로, 아래의 경우에서 미들웨어는 요청이 어플리케이션에 의해 처리된 <strong>후</strong>에 실행될 것입니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;?php namespace App\Http\Middleware;

class AfterMiddleware implements Middleware {

    public function handle($request, Closure $next)
    {
        $response = $next($request);

        // Perform action

        return $response;
    }
}
</code></pre></div>
<p><a name="registering-middleware"></a></p>

<h2 id="미들웨어-등록하기">미들웨어 등록하기</h2>

<h3 id="전역-미들웨어">전역 미들웨어</h3>

<p>만약 어플리케이션의 모든 HTTP 요청에 대하여 미들웨어가 작동되기를 원한다면, <code>app/Http/Kernel.php</code> 클래스의 <code>$middleware</code> 프로퍼티에 미들웨어를 등록하시면 됩니다.</p>

<h3 id="라우트에-미들웨어-할당하기">라우트에 미들웨어 할당하기</h3>

<p>미들웨어를 특정 라우트에만 할당하고 싶을 때에는 우선 <code>app/Http/Kernel.php</code> 파일에 그 미들웨어의 키(short-hand key)를 지정해야 합니다. 기본적으로, 이 Kernel 클래스의  <code>$routeMiddleware</code>  프로퍼티는 라라벨에 포함된 미들웨어들의 목록을 가지고 있습니다. 추가하려는 미들웨어에 원하는 키를 지정하고 이 목록에 붙여넣으십시오.</p>

<p>미들웨어를 HTTP 커널에 등록했다면, 라우트의 옵션 배열에서 <code>middleware</code> 키를 사용할 수 있습니다:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Route::get(&#39;admin/profile&#39;, [&#39;middleware&#39; =&gt; &#39;auth&#39;, function()
{
    //
}]);
</code></pre></div>
<p><a name="terminable-middleware"></a></p>

<h2 id="종료가능한-미들웨어">종료가능한 미들웨어</h2>

<p>가끔 미들웨어는 HTTP 응답을 브라우저로 전송하고 난 이후에 어떤 작업을 수행할 필요가 있을지도 모릅니다. 예를 들어, 라라벨에 내장된 &quot;session&quot; 미들웨어는 응답이 브라우저로 보내진 <em>후</em>에 세션데이터를 저장소에 저장합니다. 이런 경우, 미들웨어를 &quot;terminable&quot;로 정의하면 됩니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">use Illuminate\Contracts\Routing\TerminableMiddleware;

class StartSession implements TerminableMiddleware {

    public function handle($request, $next)
    {
        return $next($request);
    }

    public function terminate($request, $response)
    {
        // Store the session data...
    }

}
</code></pre></div>
<p>위와 같이 <code>handle</code> 메소드를 정의하고 나서 <code>TerminableMiddleware</code>는 <code>terminate</code> 메소드를 추가로 정의합니다. 이 메소드는 요청 변수와 응답 변수를 모두 인자로 받습니다. 종료 가능한 미들웨어를 정의했다면, 그것을 HTTP 커널의 전역 미들웨어 목록에 추가해 주어야 합니다.</p>

      </article>

    
        </div>
    </div>
</div>
<script>
$('p a[name]').each(function(){
  var name = $(this).attr('name');
  $(this).parent().next('h2').wrapInner('<a name=' + name + '></a>');
  $(this).parent().remove();
});
$('code[class=language-text]').each(function(){
	$(this).removeClass('language-text').addClass('language-php');
});
</script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
  var pageTracker = _gat._getTracker("UA-46389165-7");
pageTracker._trackPageview();
} catch(err) {}
</script>

  </body>

</html>
